# DNA Snakemake Proto-Workflow

This repository is based on the [Snakemake tutorial](http://snakemake.readthedocs.io/en/latest/tutorial/welcome.html) and [PaneucalyptShortReads](https://github.com/kdmurray91/PaneucalyptShortReads)


 <img src="https://divingintogeneticsandgenomics.rbind.io/img/snakemake.png" alt="Girl in a jacket" width="200" height="150">  

----

## [Setup](https://snakemake.readthedocs.io/en/stable/tutorial/setup.html)

The easiest way to setup these prerequisites is to use the **Miniconda** Python 3 distribution.

```
$ wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
$ bash Miniconda3-latest-Linux-x86_64.sh
```

**Creating an environment with the required software**

> NOTE: conda's enviroment name in these examples is `snkmk`.

```
$ conda env create --name snkmk --file envs/condaenv.yml
```

**Activate the enviroment using:**

```
$ conda activate snkmk
```

**Check enviroments**
```
conda info --envs
```

**Delete enviroment**
```
conda remove --name myenv --all
```

**Update enviroment**

```
source activate snkmk
conda env update --file envs/condaenv.yml
```

----

## Data

Main directory content:

```
.
├── config.yml
├── envs
├── genomes_and_annotations
├── metadata
├── output
├── rules
├── samples
├── scripts
├── Snakefile
├── snpEff.config
├── utils
├── ...
```

The workflow uses the data from the following folders:

- **genomes_and_annotations**
- **samples**

You can download example data for testing the workflow. [click here to download](https://drive.google.com/drive/folders/1kpJsghU-jNTSKC9uEB9khos390lZNROr?usp=sharing)


----

## Reproduce results

> NOTE: the ```output``` directory and ```metadata``` files are generated by the workflow.

get **dag.svg** and check rules (see ```--dag -npr```)

```
snakemake --dag -npr -j -1 | dot -Tsvg > dag.svg
eog dag.svg
```

**Run complete Workflow**

```
snakemake  -npr -j -1
```

### Check config and metadata

```utils/check_config.py``` allows you to read and print the config files:

```
from utils.check_config import *
config = readconfig('config.yml')
pconfig(config)
config['qc']
```


```utils/check_metadata.py``` allows you to print the metadata generated at the ```common``` rule:

```
python utils/check_metadata.py
```
